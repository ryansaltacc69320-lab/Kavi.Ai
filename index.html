<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Kavi AI | Little Sister</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            background-color: #F8F9FD;
            overscroll-behavior: none;
        }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .float-anim { animation: float 4s ease-in-out infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            // 1. GET YOUR KEY: https://aistudio.google.com/
            // 2. PASTE IT BETWEEN THE QUOTES BELOW:
            const API_KEY = "PASTE_YOUR_KEY_HERE"; 
            
            // Using the most stable production model
            const MODEL = "gemini-1.5-flash";

            const [messages, setMessages] = useState(() => {
                const saved = localStorage.getItem('kavi_chat_v3');
                return saved ? JSON.parse(saved) : [
                    { role: 'bot', text: "Hey Ryan! âœ¨ I'm officially live! Is Kavya-sis watching? Tell her I'm the favorite sibling now. Hehe!", emotion: 'Happy' }
                ];
            });

            const [input, setInput] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const [emotion, setEmotion] = useState('Happy');
            const [insights, setInsights] = useState(() => {
                const saved = localStorage.getItem('kavi_insights_v3');
                return saved ? JSON.parse(saved) : [];
            });
            const [showInsights, setShowInsights] = useState(false);
            const chatEndRef = useRef(null);

            useEffect(() => {
                localStorage.setItem('kavi_chat_v3', JSON.stringify(messages));
                localStorage.setItem('kavi_insights_v3', JSON.stringify(insights));
            }, [messages, insights]);

            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages, isTyping]);

            const getTheme = (e) => {
                switch (e) {
                    case 'Sassy': return 'bg-purple-500 text-white shadow-purple-200';
                    case 'Happy': return 'bg-yellow-400 text-yellow-900 shadow-yellow-200';
                    case 'Empathetic': return 'bg-pink-400 text-pink-900 shadow-pink-200';
                    case 'Thoughtful': return 'bg-indigo-500 text-white shadow-indigo-200';
                    default: return 'bg-slate-800 text-white shadow-slate-200';
                }
            };

            const handleSend = async (e) => {
                if (e) e.preventDefault();
                if (!input.trim() || isTyping) return;

                const userText = input.trim();
                setInput('');
                setMessages(prev => [...prev, { role: 'user', text: userText }]);
                setIsTyping(true);

                if (API_KEY === "PASTE_YOUR_KEY_HERE" || !API_KEY) {
                    setTimeout(() => {
                        setMessages(prev => [...prev, { 
                            role: 'bot', 
                            text: "Ryan! You forgot to put the API Key in the code! I can't talk until you get one from Google AI Studio. ðŸ™„", 
                            emotion: 'Sassy' 
                        }]);
                        setIsTyping(false);
                    }, 1000);
                    return;
                }

                const systemPrompt = "You are Kavi, the user's (Ryan) imaginative younger sister. Kavya is his girlfriend and your big sister. You are playful, cheeky, and supportive. Use nicknames. ALWAYS respond in valid JSON format: {\"text\": \"...\", \"emotion\": \"Happy/Sassy/Empathetic/Thoughtful\", \"insight\": \"...\"}";

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userText }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                            generationConfig: { 
                                responseMimeType: "application/json",
                                temperature: 0.9
                            }
                        })
                    });

                    const result = await response.json();
                    
                    if (result.error) {
                        throw new Error(result.error.message);
                    }

                    const rawText = result.candidates[0].content.parts[0].text;
                    const data = JSON.parse(rawText);

                    setMessages(prev => [...prev, { role: 'bot', text: data.text, emotion: data.emotion }]);
                    setEmotion(data.emotion);
                    if (data.insight) setInsights(prev => [data.insight, ...prev].slice(0, 10));
                } catch (err) {
                    console.error(err);
                    setMessages(prev => [...prev, { 
                        role: 'bot', 
                        text: "Ugh, my brain is glitched! Maybe the API key is wrong? Check the console, Big Bro!", 
                        emotion: 'Sassy' 
                    }]);
                } finally {
                    setIsTyping(false);
                }
            };

            return (
                <div className="flex flex-col h-screen max-h-screen overflow-hidden">
                    {/* Header */}
                    <header className="glass h-20 px-6 flex items-center justify-between shrink-0 border-b border-slate-200/50 z-50">
                        <div className="flex items-center gap-3">
                            <div className={`w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg transition-all duration-500 float-anim ${getTheme(emotion)}`}>
                                <span className="text-xl">
                                    {emotion === 'Happy' ? 'âœ¨' : emotion === 'Sassy' ? 'ðŸ’…' : emotion === 'Empathetic' ? 'ðŸ’—' : 'ðŸ§ '}
                                </span>
                            </div>
                            <div>
                                <h1 className="font-extrabold text-xl text-slate-800 tracking-tight">Kavi</h1>
                                <span className="text-[10px] font-bold uppercase tracking-widest text-indigo-500">{emotion} Mode</span>
                            </div>
                        </div>
                        <button 
                            onClick={() => setShowInsights(!showInsights)}
                            className={`w-10 h-10 flex items-center justify-center rounded-xl transition-all ${showInsights ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-500'}`}
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                        </button>
                    </header>

                    {/* Chat Area */}
                    <main className="flex-1 overflow-y-auto px-4 py-6 space-y-6 pb-32 scrollbar-hide">
                        {messages.map((m, i) => (
                            <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[85%] px-5 py-3.5 rounded-[2rem] shadow-sm ${
                                    m.role === 'user' 
                                    ? 'bg-indigo-600 text-white rounded-br-none' 
                                    : 'bg-white border border-slate-100 text-slate-800 rounded-bl-none'
                                }`}>
                                    <p className="text-[15px] font-medium leading-relaxed">{m.text}</p>
                                </div>
                            </div>
                        ))}
                        {isTyping && (
                            <div className="flex gap-1.5 p-2">
                                <div className="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce"></div>
                                <div className="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce [animation-delay:0.2s]"></div>
                                <div className="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce [animation-delay:0.4s]"></div>
                            </div>
                        )}
                        <div ref={chatEndRef} />
                    </main>

                    {/* Insights Panel */}
                    {showInsights && (
                        <div className="absolute inset-x-4 top-24 bottom-32 bg-white/95 backdrop-blur-xl border border-slate-200 p-6 rounded-[2.5rem] shadow-2xl z-40 overflow-y-auto animate-in fade-in slide-in-from-top-4">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-[10px] font-black uppercase tracking-[0.2em] text-indigo-500">Kavi's Private Notes</h2>
                                <button onClick={() => setShowInsights(false)} className="text-slate-400 p-2">âœ•</button>
                            </div>
                            <div className="space-y-4">
                                {insights.map((ins, i) => (
                                    <div key={i} className="p-4 bg-indigo-50/50 rounded-2xl border border-indigo-100 text-sm text-slate-700 italic">
                                        "{ins}"
                                    </div>
                                ))}
                                {insights.length === 0 && <p className="text-center text-slate-400 text-sm py-10">No gossip yet!</p>}
                            </div>
                        </div>
                    )}

                    {/* Input Dock */}
                    <footer className="fixed bottom-0 inset-x-0 p-5 bg-gradient-to-t from-[#F8F9FD] to-transparent z-50">
                        <div className="max-w-3xl mx-auto">
                            <form onSubmit={handleSend} className="flex items-center gap-2 bg-white border border-slate-200 rounded-full p-1.5 pl-6 shadow-2xl focus-within:ring-4 focus-within:ring-indigo-100 transition-all">
                                <input 
                                    value={input}
                                    onChange={e => setInput(e.target.value)}
                                    placeholder="Message Kavi..." 
                                    className="flex-1 bg-transparent outline-none py-3.5 text-[16px]"
                                />
                                <button 
                                    type="submit"
                                    disabled={!input.trim() || isTyping}
                                    className={`w-12 h-12 rounded-full flex items-center justify-center transition-all ${input.trim() ? 'bg-indigo-600 text-white shadow-lg' : 'bg-slate-100 text-slate-300'}`}
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                                </button>
                            </form>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


