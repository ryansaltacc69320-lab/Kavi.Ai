<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kavi AI | Little Sister</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-5px); } }
        .float-anim { animation: float 3s ease-in-out infinite; }
    </style>
</head>
<body class="bg-[#F8F9FD]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Icons handled via SVG for zero-dependency portability
        const Icons = {
            Send: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>,
            Sparkles: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path></svg>,
            Heart: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
        };

        const App = () => {
            const API_KEY = ""; // Provided by host environment or paste your own here
            const MODEL = "gemini-2.5-flash-preview-09-2025";

            const [messages, setMessages] = useState(() => {
                const saved = localStorage.getItem('kavi_web_history');
                return saved ? JSON.parse(saved) : [
                    { role: 'bot', text: "Hey Ryan! âœ¨ Where's Kavya-sis? Are you two being all lovey-dovey without me again? Unfair!", emotion: 'Sassy' }
                ];
            });
            const [input, setInput] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const [emotion, setEmotion] = useState('Happy');
            const [showInsights, setShowInsights] = useState(false);
            const [insights, setInsights] = useState(() => {
                const saved = localStorage.getItem('kavi_web_insights');
                return saved ? JSON.parse(saved) : [];
            });
            const chatEndRef = useRef(null);

            useEffect(() => {
                localStorage.setItem('kavi_web_history', JSON.stringify(messages));
                localStorage.setItem('kavi_web_insights', JSON.stringify(insights));
            }, [messages, insights]);

            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages, isTyping]);

            const getTheme = (e) => {
                switch (e) {
                    case 'Sassy': return 'bg-purple-500 text-white';
                    case 'Happy': return 'bg-yellow-400 text-yellow-900';
                    case 'Empathetic': return 'bg-pink-400 text-pink-900';
                    case 'Thoughtful': return 'bg-indigo-500 text-white';
                    default: return 'bg-slate-800 text-white';
                }
            };

            const handleSend = async (e, quickText = null) => {
                if (e) e.preventDefault();
                const text = quickText || input;
                if (!text.trim() || isTyping) return;

                setInput('');
                setMessages(prev => [...prev, { role: 'user', text }]);
                setIsTyping(true);

                const system = `You are Kavi, Ryan's (user) imaginative little sister. Kavya is your big sis (his girlfriend). Be playful, sassy, and supportive. JSON only: {"text": "...", "emotion": "Sassy/Happy/Empathetic/Thoughtful", "insight": "..."}`;

                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text }] }],
                            systemInstruction: { parts: [{ text: system }] },
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    const data = await res.json();
                    const json = JSON.parse(data.candidates[0].content.parts[0].text);
                    setMessages(prev => [...prev, { role: 'bot', text: json.text, emotion: json.emotion }]);
                    setEmotion(json.emotion);
                    if (json.insight) setInsights(prev => [json.insight, ...prev].slice(0, 5));
                } catch (err) {
                    setMessages(prev => [...prev, { role: 'bot', text: "Brain freeze! Ryan, help!!", emotion: 'Sassy' }]);
                } finally {
                    setIsTyping(false);
                }
            };

            return (
                <div className="flex flex-col h-screen max-h-screen overflow-hidden">
                    <header className="glass h-20 px-6 flex items-center justify-between z-50 border-b border-slate-200/50">
                        <div className="flex items-center gap-3">
                            <div className={`w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg transition-all duration-500 float-anim ${getTheme(emotion)}`}>
                                <Icons.Heart />
                            </div>
                            <div>
                                <h1 className="font-extrabold text-xl">Kavi</h1>
                                <span className="text-[10px] uppercase font-black tracking-widest text-indigo-500">{emotion}</span>
                            </div>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => { if(confirm("Clear history?")) { setMessages([]); setInsights([]); localStorage.clear(); }}} className="p-2 text-slate-400"><Icons.Trash /></button>
                            <button onClick={() => setShowInsights(!showInsights)} className={`p-2 rounded-xl ${showInsights ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-500'}`}><Icons.Sparkles /></button>
                        </div>
                    </header>

                    <main className="flex-1 overflow-y-auto px-4 py-8 space-y-6 scrollbar-hide">
                        {messages.map((m, i) => (
                            <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[85%] px-5 py-3 rounded-3xl shadow-sm ${m.role === 'user' ? 'bg-indigo-600 text-white rounded-br-none' : 'bg-white border border-slate-100 rounded-bl-none'}`}>
                                    <p className="text-[15px] leading-relaxed">{m.text}</p>
                                </div>
                            </div>
                        ))}
                        {isTyping && <div className="flex gap-1 pl-2"><div className="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce"></div><div className="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce [animation-delay:0.2s]"></div><div className="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce [animation-delay:0.4s]"></div></div>}
                        <div ref={chatEndRef} />
                    </main>

                    {showInsights && (
                        <div className="absolute inset-x-4 top-24 z-40 bg-white/95 backdrop-blur-xl border border-slate-200 p-6 rounded-[2rem] shadow-2xl animate-in slide-in-from-top-2">
                            <h3 className="text-[10px] font-black uppercase text-indigo-500 mb-4">Sisterly Observations</h3>
                            <div className="space-y-3">
                                {insights.map((ins, i) => <div key={i} className="text-sm bg-indigo-50 p-4 rounded-2xl border border-indigo-100">{ins}</div>)}
                                {insights.length === 0 && <p className="text-slate-400 text-sm text-center py-4">Nothing to gossip about yet, Ryan!</p>}
                            </div>
                        </div>
                    )}

                    <footer className="p-4 bg-gradient-to-t from-[#F8F9FD] to-transparent">
                        <div className="flex gap-2 overflow-x-auto pb-4 scrollbar-hide">
                            <button onClick={() => handleSend(null, "How's Kavya-sis today?")} className="shrink-0 px-4 py-1.5 bg-white border border-slate-200 rounded-full text-xs font-bold text-slate-500 hover:text-indigo-600 transition-all">Check on Kavya</button>
                            <button onClick={() => handleSend(null, "Give me some brotherly advice")} className="shrink-0 px-4 py-1.5 bg-white border border-slate-200 rounded-full text-xs font-bold text-slate-500 hover:text-indigo-600 transition-all">Advice</button>
                        </div>
                        <form onSubmit={handleSend} className="max-w-4xl mx-auto flex items-center gap-2 bg-white border border-slate-200 rounded-full p-1.5 pl-5 shadow-xl">
                            <input value={input} onChange={e => setInput(e.target.value)} placeholder="Message Kavi..." className="flex-1 bg-transparent outline-none py-3 text-[16px]" />
                            <button type="submit" className="w-12 h-12 bg-indigo-600 text-white rounded-full flex items-center justify-center shadow-lg active:scale-95 transition-all"><Icons.Send /></button>
                        </form>
                    </footer >
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

